# cil2020-road-segmentation

Team Member: Xiao'ao Song, Weiyi Wang, Pavel Pozdnyakov, Dominik Alberto

This repository contains the tools and models for the the course project of 
[Computational Intelligence Lab](http://da.inf.ethz.ch/teaching/2020/CIL/) (Spring 2020): Road Segmentaion.

Credit: [TorchSeg](https://github.com/ycszen/TorchSeg/) for the structure of repository

## Prerequisites
- PyTorch >= 1.0
  - `pip3 install torch torchvision`
- Easydict
  - `pip3 install easydict`
- tqdm
  - `pip3 install tqdm`
  
## Project Structure

```shell
├── README.md
├── data  # datasets and submission script
├── core  # helper function and utils for model(adopted and modified from TorchSeg git: https://github.com/ycszen/TorchSeg/)
├── log   # appears once you train the model
└── myModels
  ├── resnet50
  ├── other models ...
    ├── config.py
    ├── dataloader.py
    ├── eval.py
    ├── network.py
    ├── pred.py
    └── train.py
```

### Prepare data
Before training the model, you will need to place the training data under **../CIL_Road_Seg/data/training/** and place the test data under **../CIL_Road_Seg/data/training/test_images**

The data will be loaded with a tab-separated files specifying the path of images and groundtruth, `train.txt`, `val.txt`, `test.txt`.

For **train.txt** or **val.txt**:

```shell
path-of-the-image   path-of-the-groundtruth
```

For **test.txt**:

```shell
path-of-the-image   path-of-the-image
```

These path files can be generated by **validator_generation.py**  under **../CIL_Road_Seg/data/**

### Training
Specify which CUDA device:
```shell
python train.py -d 0
```
Restore from saved checkpoints

```shell
python train.py -d 0 -c log/snapshot/epoch-last.pth
```
### Evalaute

```shell
python eval.py -d 0 -p ./val
```
### Predict
Specify which CUDA device:

```shell
python pred.py -d 0 -p ./pred
```
or specify the checkpoints
```shell
python pred.py -d 0 -c log/snapshot/epoch-last.pth
```
### Create submission.csv

```shell
cd ../CIL_Road_Seg/data/
python mask_to_submission.py --name submission -p pred/
```
 
### A sample workflow:

```shell
cd /CIL_Road_Seg/myModels/resnet50
# train with CUDA device 0
python train50.py -d 0
# eval using the default last epoh
python eval.py -d 0 -p ./val
# generate predicted groundtruth
python pred.py -d 0 -p ./pred
# generate submission.csv
python ../../data/mask_to_submission.py --name submission -p ./pred/
# submit the submission.csv generated
```

